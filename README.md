# How to run

The following guide showcases how to initialize the project, as well as running it.

## Initialize the project and prepare prerequisites 
First download the pretrained models, available using the following google drive link:
[Pretrained Models](https://drive.google.com/drive/folders/15lBaFHykahxCvu8l5j0M1-lB-6afP9i5?usp=sharing)

Clone the project to your local computer, then move the pretrained models to the folowing folders:
- `pose_model_12.pt` → `pose2/checkpoints`
- `peach-sweep-1.pt` → `bbox/checkpoints`
- `extension_test_11_31` → `extension/checkpoints`



After cloaning the project run the following commands in the terminal to install necessary dependencies and make
sure that the project is ran from the root:
```
pip install -r requirements.txt
```

For downloading the data and placing it in the correct path run
```
python prep_data.py --gf https://drive.google.com/drive/folders/1tbLTTAB1jxiGBpHB5HzR0Ih_z0BDtfi_?usp=sharing/Linemod_preprocessed.zip
```

The following code was ran using a A100 GPU with 40GB of VRAM, adjust the batch size accordingly. 

## Evaluating the models on the test dataset using the whole pipeline. 
To evaluate the models (RGB and RGB-D) on the test dataset run the following from the root:
```
python -m test --bs {your batch size, default=16} --extension {If RGB-D or RGB data, True = RGB-D}
```

## Visualize 2d bounding box predictions
To visualize the 2d bounding box predictions generated by the Faster R-CNN model run the follwing:
```
python -m bbox.output_viewer
```

## Visualize 3D bounding boxes predicted by the models
To visualize some result for the models, run the following from the root:
```
python -m visualize
```

## Training, validating and testing individual parts

### Run phase 2 separately
To train and run phase 2, i.e just retrieving the the 2d bounding boxes run the following

```
python -m bbox.main --{args} --no-log

The arguments include:
- lr:  learning rate
- bs:  batch size
- epochs:  the number of epochs
- optimizer:  the name of the optimizer
- scheduler:  the name of the scheduler
- wb:   if wandb should be used, else specify --no-log
- lm:   name for loading model 
- sm:   name for saving model
- tr:   how much of the model that is trainable
- fm:   fasterRcnn model name
- test:     if testing should be carried out
```
For example run this:
```
python -m bbox.main --epochs 1 --bs 16 --no-log --sm test_model
```

### Run phase 3 separately (RGB data)
To train and run phase 3, i.e estimating the 6d pose from rgb images run the following

```
python -m pose2.main --{args} --no-log

The arguments include:
- lr:  learning rate
- bs:  batch size
- epochs:  the number of epochs
- optimizer:  the name of the optimizer
- scheduler:  the name of the scheduler
- wb:   if wandb should be used, else specify --no-log
- lm:   name for loading model 
- sm:   name for saving model
- mod:   the name of the model that should be used  
- test:   if testing should be carried out

```
For example run this:
```
python -m pose2.main --epochs 1 --bs 16 --no-log --sm test_model
```


### Run phase 4 separately (RGB-D data)
To train and run phase 4, i.e estimating the 6d pose from rgb and depth images run the following

```
python -m extension.main --{args} --no-log

The arguments include:
- lr:  learning rate
- bs:  batch size
- epochs:  the number of epochs
- optimizer:  the name of the optimizer
- scheduler:  the name of the scheduler
- wb:   if wandb should be used, else specify --no-log
- lm:   name for loading model 
- sm:   name for saving model
- mod:   the name of the model that should be used  
- test:   if testing should be carried out

```

For example run this:
```
python -m extension.main --epochs 1 --bs 16 --no-log --sm test_model
```
